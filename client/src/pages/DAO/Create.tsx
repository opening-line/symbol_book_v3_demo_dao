import { PrivateKey, utils } from "symbol-sdk"
import { models, Network, SymbolFacade } from "symbol-sdk/symbol"

const NODE_URL = 'https://sym-test-03.opening-line.jp:3001'

export const CreateDAOPage: React.FC = () => {
  const sign = async () => {
    const pk = '39324C83D5427071E2D56513558A56D50EF874A92CCD53F5AE7976AE1473BBA6'
    const facade = new SymbolFacade(Network.TESTNET)
    const acc = facade.createAccount(new PrivateKey(pk))
    
    const payload = '68060000000000001CD1ACA5BC69647C20F95B493D05B6BD8BFDD05735C4FF86ED6D364CEB8F6556B3608E9C7C045F31305BAA23071864A2FD0B9856DA0AE6A5A06A9C5C133F5007B98C5817945BFA966FB7E362E5045EC2D7193777E5A05327A0F95AF8F1BC8BD9000000000298414100B0040000000000223B54EA0E0000009105278D0ADA59C7C7F166B7C97C3301B78DE651EC5A082AE925DD9C70DF894658050000000000006000000000000000B98C5817945BFA966FB7E362E5045EC2D7193777E5A05327A0F95AF8F1BC8BD9000000000198544198D207DFAA3E8C283CB0724D238C62BAFA846E5DDD4E21F50000010000000000CE8BA0672E21C07200E1F50500000000460000000000000063D8F7DCDFD915C5013E869CB74F81C04FAAAA0F8CFE476F3FBE2EEB2D1EDE730000000001984D415596629CD884167200000000000000006212121D08000000410000000000000063D8F7DCDFD915C5013E869CB74F81C04FAAAA0F8CFE476F3FBE2EEB2D1EDE730000000001984D425596629CD884167264000000000000000100000000000000460000000000000063D8F7DCDFD915C5013E869CB74F81C04FAAAA0F8CFE476F3FBE2EEB2D1EDE730000000001984D415B673DD77E8ADC160000000000000000A5CCDF7708000000410000000000000063D8F7DCDFD915C5013E869CB74F81C04FAAAA0F8CFE476F3FBE2EEB2D1EDE730000000001984D425B673DD77E8ADC1664000000000000000100000000000000500000000000000063D8F7DCDFD915C5013E869CB74F81C04FAAAA0F8CFE476F3FBE2EEB2D1EDE7300000000019855410101010000000000981627A042A09E0BEE733E739499FFD51A05E94640C7D10B6400000000000000B98C5817945BFA966FB7E362E5045EC2D7193777E5A05327A0F95AF8F1BC8BD9000000000198444198D207DFAA3E8C283CB0724D238C62BAFA846E5DDD4E21F505000000000000001000100037323136383464383963363239363535000000009400000000000000B98C5817945BFA966FB7E362E5045EC2D7193777E5A05327A0F95AF8F1BC8BD9000000000198444198D207DFAA3E8C283CB0724D238C62BAFA846E5DDD4E21F501000000000000004000400030443635413145423036413335364132324642324643344639424531423446463931444645363333314334464430443646313843363738364145423630443831000000009400000000000000B98C5817945BFA966FB7E362E5045EC2D7193777E5A05327A0F95AF8F1BC8BD9000000000198444198D207DFAA3E8C283CB0724D238C62BAFA846E5DDD4E21F502000000000000004000400033343632313843454439323536463631463435423334384644303831333444434330413030464544363832343643443838324436413230373739304643343844000000009400000000000000B98C5817945BFA966FB7E362E5045EC2D7193777E5A05327A0F95AF8F1BC8BD9000000000198444198D207DFAA3E8C283CB0724D238C62BAFA846E5DDD4E21F503000000000000004000400041334435304631423344424242313434363146313433383833383834384530364438433937313936313233393141413438303637383735413031324433363141000000009400000000000000B98C5817945BFA966FB7E362E5045EC2D7193777E5A05327A0F95AF8F1BC8BD9000000000198444198D207DFAA3E8C283CB0724D238C62BAFA846E5DDD4E21F504000000000000004000400041424433314332463932414641353443373031423434453230323430424241323343413838324639313545464235314130363544434246413332433939463130000000006400000000000000B98C5817945BFA966FB7E362E5045EC2D7193777E5A05327A0F95AF8F1BC8BD9000000000198444198D207DFAA3E8C283CB0724D238C62BAFA846E5DDD4E21F506000000000000001000100031366463386137656437336436373562000000005700000000000000B98C5817945BFA966FB7E362E5045EC2D7193777E5A05327A0F95AF8F1BC8BD9000000000198444198D207DFAA3E8C283CB0724D238C62BAFA846E5DDD4E21F507000000000000000300030061616100000000000000000063D8F7DCDFD915C5013E869CB74F81C04FAAAA0F8CFE476F3FBE2EEB2D1EDE73B3D93FDC46F7A7FB6AA832F3E2E7267B292443FEFDEE12769AE33EA3D24746C40906740583C513CAA49AD24502AA8296561BB60949905E7343F5B09EB031C903'



    const tx = models.AggregateCompleteTransactionV2.deserialize(utils.hexToUint8(payload))
    
    const sig = acc.signTransaction(tx)

    facade.transactionFactory.static.attachSignature(tx, sig)

    const cosign = facade.cosignTransaction(acc.keyPair, tx)

    tx.cosignatures.push(cosign)

    const jsonPayload2 = `{"payload":"${utils.uint8ToHex(tx.serialize())}"}`

    const hash = facade.hashTransaction(tx)

    const sendRes = await fetch(new URL("/transactions", NODE_URL), {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: jsonPayload2,
    }).then((res) => res.json())
    console.log(sendRes)

    await new Promise((resolve) => setTimeout(resolve, 1000))

    const statusRes = await fetch(
      new URL("/transactionStatus/" + hash, NODE_URL),
    ).then((res) => res.json())
    console.log(statusRes)
      
  }
  return <div>CREATE DAO PAGE
    <button onClick={sign}>PUSH</button>
  </div>
}
